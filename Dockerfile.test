FROM python:3.11-slim
WORKDIR /app

# 시스템 패키지 설치
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    make \
    curl \
  && rm -rf /var/lib/apt/lists/*

# 기본 Python 패키지만 설치
RUN pip install --upgrade pip
RUN pip install flask gunicorn

# 테스트 서버만 복사
COPY test_server.py .

# Cloud Run은 PORT 환경변수를 설정하므로 기본값 설정
ENV PORT=8080

# 포트 노출
EXPOSE 8080

# 간단한 Flask 서버 실행
CMD exec gunicorn \
     --bind 0.0.0.0:$PORT \
     --workers 1 \
     --threads 8 \
     --timeout 0 \
     --log-level debug \
     --access-logfile - \
     --error-logfile - \
     test_server:app